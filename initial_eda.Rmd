---
title: "Olfaction Data"
author: "Vidya Koesmahargyo"
date: "10/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Loading in the data:
```{r}
library(dplyr)
library(tibble)
library(ggplot2)
library(ggfortify)
library(OpenImageR)
library(fastICA)
library(NMF)
# olfaction_data <- read.csv('training_set.txt', header = T, sep = '\t')
molec_desc <- read.csv('molecular_descriptors.txt', header = T, sep = '\t')
# olfaction_data
molec_desc
```

```{r include=FALSE}

# read in labels
labels <- read.delim("training_set.txt")

# str(labels)
colnames(labels)

# Make factors
labels$VALENCE.PLEASANTNESS <- factor(labels$VALENCE.PLEASANTNESS)
levels(labels$VALENCE.PLEASANTNESS) <- list("Unpleasent" = c(0:33), "Neutral" = c(34:66), "Pleasant" = c(67:100))

labels$INTENSITY.STRENGTH <- factor(labels$INTENSITY.STRENGTH)
levels(labels$INTENSITY.STRENGTH) <- list("Low" = c(0:33), "Medium" = c(34:66), "High" = c(67:100))

# Subset
olfaction_data <- subset(labels, Intensity == "high ", select = c("Compound.Identifier", "VALENCE.PLEASANTNESS", "INTENSITY.STRENGTH"))
str(olfaction_data)

```




PCA of molecular descriptor data (to 50 dimensions from 4870)
```{r }
#molec_desc <- read.csv('molecular_descriptors.txt', header=T, sep='\t')
molec_desc <- na.omit(molec_desc)


#molec_disc_pca <- data.frame(molec_disc[,2:4870])
molec_desc_pca <- data.frame(molec_desc)


#which(apply(molec_disc_pca, 2, var)==0) ## lookin for columns with a variance of 0

molec_desc_pca <- molec_desc_pca[ , apply(molec_desc_pca,2,var)!=0] # using only columns with variance > 0
identifiers <- molec_desc_pca[ , 1] # setting the CID column separately

molec_desc_pca <- molec_desc_pca[ , 2:ncol(molec_desc_pca) ] # setting all other columns
dim(molec_desc_pca)

as.tibble(molec_desc_pca)
pca <- prcomp(molec_desc_pca, scale. = T) # scaling pca
autoplot(pca)

screeplot(pca, 100, main='Screeplot of Olfaction data', type='l')


## cumulative scree plot
std_dev <- pca$sdev
pr_var <- std_dev^2
prop_varex <- pr_var/sum(pr_var)
plot(cumsum(prop_varex), type='b', main="Cumulative Sum Screeplot", xlab='Principle Component', ylab='Total Variance Proportion')
dim(molec_desc_pca)

data.frame(cbind(identifiers, molec_desc_pca))
colnames(molec_desc_pca)[1] <- "CID" # <- rename to CID

```

Created new column CID; did an inner merge by CID for molecular descriptors and perception data
```{r}
#joining data,
olfaction_data$CID <- olfaction_data$Compound.Identifier

#joined <- merge(olfaction_data, mol_desc, by = "CID")
joined <- merge(olfaction_data, molec_desc_pca, by = "CID")
joined[, -2]
head(joined)

dim(joined)

```
<<<<<<< HEAD
```{r}
#olfaction_data <- na.omit(olfaction_data)
#levels(joined$Intensity)
#joined_high <- filter(joined, Intensity == "high ")
```

```{r}
library(factoextra)
fviz_eig(pca)
#fviz_pca_var(pca,col.var = 'contrib',  gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),repel=TRUE)
fviz_pca_biplot(pca, repel = TRUE,col.var = "#2E9FDF",col.ind = "#696969")
```
=======

>>>>>>> 7b047345bd41d1579a994291cd19b94c92dbb7df
